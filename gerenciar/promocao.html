<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gerenciar Promo√ß√£o ‚Äì Itapolitana</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',sans-serif;background:#f5f5f8;color:#111827;min-height:100vh}
.header{background:#1F2937;color:#fff;padding:14px 20px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}
.header h1{font-size:16px;font-weight:800}
.header-btns{display:flex;gap:8px}
.btn-back{background:#374151;color:#fff;border:none;border-radius:8px;padding:8px 14px;font-size:13px;font-weight:700;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:5px}
.btn-back:hover{background:#4B5563}
.body{max-width:520px;margin:0 auto;padding:24px 16px 100px}
.card{background:#fff;border-radius:16px;border:1px solid #E5E7EB;padding:24px;margin-bottom:16px}
.card h2{font-size:16px;font-weight:800;color:#111827;margin-bottom:6px}
.card p{font-size:13px;color:#6A0DAD;font-weight:600;margin-bottom:20px}
.field{margin-bottom:18px}
.field label{display:block;font-size:13px;font-weight:700;color:#374151;margin-bottom:6px}
.field input[type=text],.field input[type=url],.field textarea{width:100%;padding:12px 14px;border:1.5px solid #E5E7EB;border-radius:10px;font-size:14px;outline:none;font-family:inherit;resize:vertical}
.field input:focus,.field textarea:focus{border-color:#6A0DAD}
.field textarea{min-height:90px}
/* Upload de foto */
.upload-area{border:2px dashed #D1D5DB;border-radius:12px;padding:24px;text-align:center;cursor:pointer;transition:border-color .2s,background .2s;position:relative;background:#FAFAFA}
.upload-area:hover,.upload-area.drag{border-color:#6A0DAD;background:#F5F0FF}
.upload-area input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.upload-icon{font-size:36px;margin-bottom:8px}
.upload-txt{font-size:14px;font-weight:700;color:#374151}
.upload-sub{font-size:12px;color:#9CA3AF;margin-top:4px}
.preview-wrap{margin-top:14px;display:none}
.preview-wrap img{width:100%;border-radius:10px;max-height:220px;object-fit:cover;border:1px solid #E5E7EB}
.btn-remove-img{background:#FEE2E2;color:#EF4444;border:1px solid #FECACA;border-radius:8px;padding:7px 14px;font-size:12px;font-weight:700;cursor:pointer;margin-top:8px;width:100%}
/* Preview do modal */
.preview-modal{background:linear-gradient(135deg,#1565C0,#D32F2F);border-radius:16px;padding:22px 18px;color:#fff;text-align:center;margin-top:16px}
.preview-modal .pm-icon{font-size:36px;margin-bottom:8px}
.preview-modal .pm-img{width:100%;border-radius:10px;max-height:160px;object-fit:cover;margin-bottom:10px;display:none}
.preview-modal .pm-title{font-size:18px;font-weight:900;margin-bottom:6px}
.preview-modal .pm-desc{font-size:13px;opacity:.9;margin-bottom:14px;line-height:1.5}
.preview-modal .pm-btn{background:#F9A825;color:#111;border:none;border-radius:10px;padding:11px 20px;font-size:14px;font-weight:800;width:100%;cursor:pointer}
/* Bot√µes de a√ß√£o */
.save-bar{position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:1px solid #E5E7EB;padding:12px 16px;display:flex;gap:10px;justify-content:center;z-index:200}
.btn-salvar{background:#6A0DAD;color:#fff;border:none;border-radius:10px;padding:13px 28px;font-size:15px;font-weight:800;cursor:pointer;flex:1;max-width:220px}
.btn-salvar:hover{background:#5a0b9d}
.btn-limpar{background:#FEE2E2;color:#EF4444;border:1px solid #FECACA;border-radius:10px;padding:13px 20px;font-size:14px;font-weight:700;cursor:pointer}
.btn-limpar:hover{background:#FECACA}
.status{font-size:13px;font-weight:700;color:#10B981;text-align:center;padding:6px;display:none}
/* Toggle ativo */
.toggle-row{display:flex;align-items:center;justify-content:space-between;padding:14px 0;border-bottom:1px solid #F3F4F6;margin-bottom:14px}
.toggle-row label{font-size:14px;font-weight:700;color:#111827}
.toggle-row span{font-size:12px;color:#6B7280;display:block;margin-top:2px}
.toggle{position:relative;width:48px;height:26px;flex-shrink:0}
.toggle input{opacity:0;width:0;height:0}
.slider{position:absolute;inset:0;background:#D1D5DB;border-radius:26px;cursor:pointer;transition:.3s}
.slider:before{content:'';position:absolute;width:20px;height:20px;left:3px;top:3px;background:#fff;border-radius:50%;transition:.3s}
input:checked+.slider{background:#6A0DAD}
input:checked+.slider:before{transform:translateX(22px)}
</style>
</head>
<body>
<div class="header">
  <h1>üéâ Gerenciar Promo√ß√£o</h1>
  <div class="header-btns">
    <a href="index.html" class="btn-back">‚öôÔ∏è Admin</a>
    <a href="../index.html" class="btn-back">üè† Site</a>
  </div>
</div>

<div class="body">
  <!-- CONFIGURA√á√ÉO -->
  <div class="card">
    <h2>üéâ Configurar Promo√ß√£o</h2>
    <p>O que voc√™ preencher aqui aparece no bot√£o "Promo√ß√£o" do site.</p>

    <div class="toggle-row">
      <div>
        <label>Promo√ß√£o Ativa</label>
        <span>Quando desativada, o bot√£o Promo√ß√£o fica oculto</span>
      </div>
      <label class="toggle">
        <input type="checkbox" id="promo-ativa" checked onchange="atualizarPreview()">
        <span class="slider"></span>
      </label>
    </div>

    <div class="field">
      <label>üì∏ Foto da Promo√ß√£o</label>
      <div class="upload-area" id="upload-area">
        <input type="file" id="foto-input" accept="image/*" onchange="carregarFoto(this)">
        <div class="upload-icon">üì∏</div>
        <div class="upload-txt">Clique ou arraste uma foto aqui</div>
        <div class="upload-sub">JPG, PNG ou WEBP ¬∑ M√°x. 5MB</div>
      </div>
      <div class="preview-wrap" id="preview-wrap">
        <img id="foto-preview" src="" alt="Preview">
        <button class="btn-remove-img" onclick="removerFoto()">üóëÔ∏è Remover Foto</button>
      </div>
    </div>

    <div class="field">
      <label>üìù T√≠tulo da Promo√ß√£o</label>
      <input type="text" id="promo-titulo" placeholder="Ex: Promo√ß√£o de Ver√£o! üåû" maxlength="60" oninput="atualizarPreview()">
    </div>

    <div class="field">
      <label>üí¨ Texto / Descri√ß√£o</label>
      <textarea id="promo-texto" placeholder="Ex: Sorvete duplo por R$ 12,00 hoje! Aproveite enquanto durar." maxlength="200" oninput="atualizarPreview()"></textarea>
    </div>

    <div class="field">
      <label>üîó Link do Bot√£o</label>
      <input type="url" id="promo-link" placeholder="https://wa.me/5516991472045" oninput="atualizarPreview()">
      <div style="font-size:11px;color:#9CA3AF;margin-top:4px">Pode ser WhatsApp, Instagram, ou qualquer link</div>
    </div>

    <div class="field">
      <label>üîò Texto do Bot√£o</label>
      <input type="text" id="promo-btn-txt" placeholder="Ex: üí¨ Falar com a Loja" maxlength="40" oninput="atualizarPreview()">
    </div>

    <!-- REL√ìGIO DA PROMO√á√ÉO -->
    <div style="background:linear-gradient(135deg,#1A0A00,#3E1A00);border-radius:14px;padding:18px;margin-top:4px">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
        <span style="font-size:22px">‚è∞</span>
        <div>
          <div style="font-size:14px;font-weight:900;color:#FFD54F">Rel√≥gio da Promo√ß√£o</div>
          <div style="font-size:11px;color:rgba(255,255,255,.65);margin-top:2px">Define at√© quando o contador regride no modal</div>
        </div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
        <div style="flex:1;min-width:140px">
          <div style="font-size:11px;color:rgba(255,255,255,.6);margin-bottom:4px;font-weight:700">DATA DE ENCERRAMENTO</div>
          <input type="date" id="promo-data-fim" oninput="atualizarTimerLabel()" style="width:100%;padding:10px 12px;border-radius:8px;border:none;font-size:14px;font-weight:700;outline:none">
        </div>
        <div style="flex:1;min-width:110px">
          <div style="font-size:11px;color:rgba(255,255,255,.6);margin-bottom:4px;font-weight:700">HOR√ÅRIO</div>
          <input type="time" id="promo-hora-fim" value="22:00" oninput="atualizarTimerLabel()" style="width:100%;padding:10px 12px;border-radius:8px;border:none;font-size:14px;font-weight:700;outline:none">
        </div>
      </div>
      <div id="timer-preview-label" style="margin-top:12px;background:rgba(255,213,79,.15);border:1px solid rgba(255,213,79,.4);border-radius:8px;padding:10px;font-size:13px;color:#FFD54F;font-weight:700;text-align:center">‚è≥ Rel√≥gio: at√© 22:00 de hoje</div>
    </div>
  </div>

  <!-- PREVIEW -->
  <div class="card">
    <h2>üëÅÔ∏è Preview do Modal</h2>
    <p>Assim vai aparecer para os clientes ao clicar em "Promo√ß√£o"</p>
    <div class="preview-modal" id="preview-modal">
      <div class="pm-icon" id="pm-icon">üéâ</div>
      <img class="pm-img" id="pm-img" src="" alt="">
      <div class="pm-title" id="pm-title">Promo√ß√£o Especial!</div>
      <div class="pm-desc" id="pm-desc">Confira nossas promo√ß√µes especiais de hoje.</div>
      <button class="pm-btn" id="pm-btn">üí¨ Falar com a Loja</button>
    </div>
  </div>

  <div class="status" id="status-ok">‚úÖ Promo√ß√£o salva! Aparecer√° no site imediatamente.</div>
</div>

<div class="save-bar">
  <button class="btn-limpar" onclick="limparPromo()">üóëÔ∏è Limpar</button>
  <button class="btn-salvar" onclick="salvarPromo()">üíæ Salvar Promo√ß√£o</button>
</div>

<script>
// Carregar dados salvos ao abrir
window.addEventListener('DOMContentLoaded', () => {
  const d = JSON.parse(localStorage.getItem('itap_promo') || '{}');
  if (d.titulo) document.getElementById('promo-titulo').value = d.titulo;
  if (d.descricao) document.getElementById('promo-texto').value = d.descricao;
  if (d.link) document.getElementById('promo-link').value = d.link;
  if (d.btnTexto) document.getElementById('promo-btn-txt').value = d.btnTexto;
  if (d.ativa === false) document.getElementById('promo-ativa').checked = false;
  if (d.imagem) {
    document.getElementById('foto-preview').src = d.imagem;
    document.getElementById('preview-wrap').style.display = 'block';
    document.getElementById('upload-area').style.display = 'none';
  }
  // Carregar data/hora do rel√≥gio
  document.getElementById('promo-data-fim').value = d.dataFim || '2026-04-01';
  document.getElementById('promo-hora-fim').value = d.horaFim || '22:00';
  atualizarPreview();
  atualizarTimerLabel();
});

function atualizarTimerLabel() {
  const data = document.getElementById('promo-data-fim').value || '2026-04-01';
  const hora = document.getElementById('promo-hora-fim').value || '22:00';
  const fim = new Date(data + 'T' + hora + ':00');
  const lbl = document.getElementById('timer-preview-label');
  if (!lbl) return;
  const agora = new Date();
  if (isNaN(fim)) { lbl.textContent = '‚ö†Ô∏è Data inv√°lida'; return; }
  const diff = fim - agora;
  if (diff <= 0) { lbl.textContent = '‚è≥ Promo√ß√£o j√° encerrada'; return; }
  const dias = Math.floor(diff / 86400000);
  const h = Math.floor((diff % 86400000) / 3600000);
  const m = Math.floor((diff % 3600000) / 60000);
  const dataFmt = fim.toLocaleDateString('pt-BR', { day: '2-digit', month: 'long', year: 'numeric' });
  lbl.textContent = `‚è≥ ${dias} dias, ${h}h e ${m}min restantes ‚Ä¢ Encerra em ${dataFmt} √†s ${hora}`;
}

function carregarFoto(input) {
  const file = input.files[0];
  if (!file) return;
  if (file.size > 5 * 1024 * 1024) { alert('Foto muito grande! M√°ximo 5MB.'); return; }
  const reader = new FileReader();
  reader.onload = e => {
    document.getElementById('foto-preview').src = e.target.result;
    document.getElementById('preview-wrap').style.display = 'block';
    document.getElementById('upload-area').style.display = 'none';
    atualizarPreview();
  };
  reader.readAsDataURL(file);
}

function removerFoto() {
  document.getElementById('foto-preview').src = '';
  document.getElementById('preview-wrap').style.display = 'none';
  document.getElementById('upload-area').style.display = 'block';
  document.getElementById('foto-input').value = '';
  atualizarPreview();
}

function atualizarPreview() {
  const titulo = document.getElementById('promo-titulo').value || 'Promo√ß√£o Especial!';
  const texto = document.getElementById('promo-texto').value || 'Confira nossas promo√ß√µes especiais de hoje.';
  const btnTxt = document.getElementById('promo-btn-txt').value || 'üí¨ Falar com a Loja';
  const imgSrc = document.getElementById('foto-preview').src;
  const temImg = imgSrc && imgSrc !== window.location.href;

  document.getElementById('pm-title').textContent = titulo;
  document.getElementById('pm-desc').textContent = texto;
  document.getElementById('pm-btn').textContent = btnTxt;

  const pmImg = document.getElementById('pm-img');
  const pmIcon = document.getElementById('pm-icon');
  if (temImg && document.getElementById('preview-wrap').style.display !== 'none') {
    pmImg.src = imgSrc;
    pmImg.style.display = 'block';
    pmIcon.style.display = 'none';
  } else {
    pmImg.style.display = 'none';
    pmIcon.style.display = 'block';
  }
}

function salvarPromo() {
  const titulo = document.getElementById('promo-titulo').value.trim();
  const descricao = document.getElementById('promo-texto').value.trim();
  const link = document.getElementById('promo-link').value.trim();
  const btnTexto = document.getElementById('promo-btn-txt').value.trim();
  const ativa = document.getElementById('promo-ativa').checked;
  const imgEl = document.getElementById('foto-preview');
  const imagem = (document.getElementById('preview-wrap').style.display !== 'none') ? imgEl.src : '';

  const dataFim = document.getElementById('promo-data-fim').value || '2026-04-01';
  const horaFim = document.getElementById('promo-hora-fim').value || '22:00';
  const dados = { titulo, descricao, link, btnTexto, ativa, imagem, dataFim, horaFim, atualizado: new Date().toISOString() };
  localStorage.setItem('itap_promo', JSON.stringify(dados));

  const s = document.getElementById('status-ok');
  s.style.display = 'block';
  setTimeout(() => s.style.display = 'none', 4000);
}

function limparPromo() {
  if (!confirm('Limpar toda a promo√ß√£o?')) return;
  localStorage.removeItem('itap_promo');
  document.getElementById('promo-titulo').value = '';
  document.getElementById('promo-texto').value = '';
  document.getElementById('promo-link').value = '';
  document.getElementById('promo-btn-txt').value = '';
  document.getElementById('promo-ativa').checked = true;
  removerFoto();
  atualizarPreview();
}

// Drag & drop
const area = document.getElementById('upload-area');
area.addEventListener('dragover', e => { e.preventDefault(); area.classList.add('drag'); });
area.addEventListener('dragleave', () => area.classList.remove('drag'));
area.addEventListener('drop', e => {
  e.preventDefault(); area.classList.remove('drag');
  const file = e.dataTransfer.files[0];
  if (file && file.type.startsWith('image/')) {
    const dt = new DataTransfer(); dt.items.add(file);
    document.getElementById('foto-input').files = dt.files;
    carregarFoto(document.getElementById('foto-input'));
  }
});
</script>
</body>
</html>
