name: Update Prices Gist

on:
  repository_dispatch:
    types: [update-prices]

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Update Gist with new prices
        env:
          GIST_TOKEN: ${{ secrets.GIST_TOKEN }}
          GIST_ID: "92bd9d1997c2fdd225ad3115c7028445"
        run: |
          PAYLOAD='${{ toJson(github.event.client_payload) }}'
          curl -s -X PATCH \
            -H "Authorization: token $GIST_TOKEN" \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Content-Type: application/json" \
            "https://api.github.com/gists/$GIST_ID" \
            -d "{\"files\":{\"itap-produtos.json\":{\"content\":$PAYLOAD}}}"
          echo "Gist atualizado!"
